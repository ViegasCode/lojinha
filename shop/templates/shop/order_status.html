<!doctype html>
<html lang="pt-br">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Status do Pedido - {{ order.short_code }}</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/order_status.css' %}" />
</head>
<body>
    <div class="container">
        <a class="back-link" href="/">← Voltar para a loja</a>
        <h1>Status do Pedido</h1>

        <div class="status-timeline">
            <div class="step {% if order.status == 'PENDING' or order.status == 'PAID' or order.status == 'SHIPPED' or order.status == 'DELIVERED' %}completed{% endif %}">
                <div class="step-icon">✔</div>
                <div class="step-label">Pedido<br>Realizado</div>
            </div>
            <div class="step {% if order.status == 'PAID' or order.status == 'SHIPPED' or order.status == 'DELIVERED' %}completed{% endif %} {% if order.status == 'PAID' %}active{% endif %}">
                <div class="step-icon">✔</div>
                <div class="step-label">Pagamento<br>Aprovado</div>
            </div>
            <div class="step {% if order.status == 'SHIPPED' or order.status == 'DELIVERED' %}completed{% endif %} {% if order.status == 'SHIPPED' %}active{% endif %}">
                <div class="step-icon">✔</div>
                <div class="step-label">Pedido<br>Enviado</div>
            </div>
            <div class="step {% if order.status == 'DELIVERED' %}completed{% endif %} {% if order.status == 'DELIVERED' %}active{% endif %}">
                <div class="step-icon">✔</div>
                <div class="step-label">Pedido<br>Entregue</div>
            </div>
        </div>

        <div class="summary">
            <div class="box">
                <div><strong>Código do Pedido:</strong> {{ order.short_code }}</div>
                <div>
                    <strong>Status:</strong>
                    <span class="pill pill-{{ order.status|lower }}">{{ order.get_status_display }}</span>
                </div>
                <div class="muted">Criado em: {{ order.created_at|date:"d/m/Y H:i" }}</div>
            </div>
            <div class="box">
                <div><strong>E-mail do cliente:</strong> {{ order.customer_email|default:"—" }}</div>
                <div><strong>Telefone:</strong> {{ order.customer_phone|default:"—" }}</div>
                <div><strong>Link público:</strong> <a href="/pedido/{{ order.public_token }}/">/pedido/{{ order.public_token }}/</a></div>
            </div>
        </div>

        <h2>Itens do Pedido</h2>
        {% if items %}
        <table class="items-table">
            <thead>
                <tr>
                    <th>Produto</th>
                    <th class="right">Qtd</th>
                    <th class="right">Preço (un.)</th>
                    <th class="right">Subtotal</th>
                </tr>
            </thead>
            <tbody>
                {% load pricing %} {# Certifique-se de que a tag 'money' está disponível #}
                {% for it in items %}
                <tr>
                    <td>
                        {% if it.product.image_url %}
                            <img src="{{ it.product.image_url }}" alt="{{ it.product.title }}" style="width:48px;height:48px;object-fit:cover;border-radius:8px;vertical-align:middle;margin-right:8px" />
                        {% endif %}
                        {{ it.product.title }}
                    </td>
                    <td class="right">{{ it.qty }}</td>
                    <td class="right">{{ it.unit_price_cents|money }}</td>
                    <td class="right">{{ it.line_total_cents|money }}</td>
                </tr>
                {% endfor %}
            </tbody>
            <tfoot>
                <tr>
                    <th colspan="3" class="right">Total do Pedido</th>
                    <th class="right">{{ order.total_cents|money }}</th>
                </tr>
            </tfoot>
        </table>
        {% else %}
            <p class="muted">Nenhum item associado a este pedido.</p>
        {% endif %}

        <div style="margin-top:24px; text-align: center;">
            <a class="btn" href="/meu-pedido/">Buscar outro pedido</a>
        </div>
    </div>
</body>
</html>